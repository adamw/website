---
title: Envers beta â€“ now with queries!
author: Adam Warski
type: blog
date: 2008-06-12T11:03:37+00:00
url: /blog/2008/06/envers-beta-now-with-queries/
disqus_identifier:
  - 1070465743
tags:
  - envers
  - java
  - hibernate

---
So far [Envers][1] made it easy to store historical data; now, with version 1.0.0.beta1 (download [here][2]), you can also query it, in two &#8220;dimensions&#8221;: for entities at a given revision and for revisions, at which an entity changed. The implementation mostly follows [Hibernate Criteria][3], with some features removed, and some added.

For example the following query returns all persons with the name &#8220;John&#8221;, sorted by their surname, which lived at the address with the given id at revision 12:

<pre lang="java" line="1" escape="true">List personsAtAddress =
      getVersionsReader().createQuery()
      .forEntitiesAtRevision(Person.class, 12)
      .addOrder(Order.asc("surname"))
      .add(VersionsRestrictions.relatedIdEq(
            "address", addressId))
      .add(VersionsRestrictions.eq("name", "John"))
      .getResultList();
</pre>

You can find more information about creating queries [on this page][4].

Warning &#8211; the schema generated by this version of Envers is incompatible with the schema generated by the preview versions. If you have any data to migrate, please write on the [forum][5]. As this is the beta release, there will be no more schema changes until the 1.0 final release.

Thanks to the [forum][5] users: talios, aamonten, genman, liuxiaodu and others for bug reports, patches, testing and ideas!

Finally, the release notes for this release are located [here][6].

As always, waiting for comments and bug reports :)

Adam

 [1]: http://www.jboss.org/envers/
 [2]: http://www.jboss.org/envers/downloads
 [3]: http://www.hibernate.org/hib_docs/v3/reference/en/html/querycriteria.html
 [4]: http://www.jboss.org/envers/queries.html
 [5]: http://www.jboss.com/index.html?module=bb&op=viewforum&f=283
 [6]: http://jira.jboss.org/jira/secure/ConfigureReport.jspa?versions=12312322&sections=1&sections=2&style=none&selectedProjectId=12310660&reportKey=pl.net.mamut%3Areleasenotes&Next=Next
